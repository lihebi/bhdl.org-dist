<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.856107a28f25c150460f.css" id="gatsby-global-css">/*! tailwindcss v2.0.4 | MIT License | https://tailwindcss.com */

/*! modern-normalize v1.0.0 | MIT License | https://github.com/sindresorhus/modern-normalize */:root{-moz-tab-size:4;-o-tab-size:4;tab-size:4}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}hr{height:0;color:inherit}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],button{-webkit-appearance:button}legend{padding:0}progress{vertical-align:baseline}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body{font-family:inherit;line-height:inherit}*,:after,:before{box-sizing:border-box;border:0 solid #e5e7eb}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input:-ms-input-placeholder,textarea:-ms-input-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.prose{color:#374151;max-width:65ch}.prose a{color:#111827;text-decoration:underline;font-weight:500}.prose strong{color:#111827;font-weight:600}.prose ol[type=A]{--list-counter-style:upper-alpha}.prose ol[type=a]{--list-counter-style:lower-alpha}.prose ol[type=i]{--list-counter-style:lower-roman}.prose ol[type="1"]{--list-counter-style:decimal}.prose ol>li{position:relative;padding-left:1.75em}.prose ol>li:before{content:counter(list-item,var(--list-counter-style,decimal)) ".";position:absolute;font-weight:400;color:#6b7280;left:0}.prose ul>li{position:relative;padding-left:1.75em}.prose ul>li:before{content:"";position:absolute;background-color:#d1d5db;border-radius:50%;width:.375em;height:.375em;top:.6875em;left:.25em}.prose hr{border-color:#e5e7eb;border-top-width:1px;margin-top:3em;margin-bottom:3em}.prose blockquote{font-weight:500;font-style:italic;color:#111827;border-left-width:.25rem;border-left-color:#e5e7eb;quotes:"\201C""\201D""\2018""\2019";margin-top:1.6em;margin-bottom:1.6em;padding-left:1em}.prose blockquote p:first-of-type:before{content:open-quote}.prose blockquote p:last-of-type:after{content:close-quote}.prose h1{color:#111827;font-weight:800;font-size:2.25em;margin-top:0;margin-bottom:.8888889em;line-height:1.1111111}.prose h2{color:#111827;font-weight:700;font-size:1.5em;margin-top:2em;margin-bottom:1em;line-height:1.3333333}.prose h3{font-size:1.25em;margin-top:1.6em;margin-bottom:.6em;line-height:1.6}.prose h3,.prose h4{color:#111827;font-weight:600}.prose h4{margin-top:1.5em;margin-bottom:.5em;line-height:1.5}.prose figure figcaption{color:#6b7280;font-size:.875em;line-height:1.4285714;margin-top:.8571429em}.prose code{color:#111827;font-weight:600;font-size:.875em}.prose code:after,.prose code:before{content:"`"}.prose a code{color:#111827}.prose pre{color:#e5e7eb;background-color:#1f2937;overflow-x:auto;font-size:.875em;line-height:1.7142857;margin-top:1.7142857em;margin-bottom:1.7142857em;border-radius:.375rem;padding:.8571429em 1.1428571em}.prose pre code{background-color:transparent;border-width:0;border-radius:0;padding:0;font-weight:400;color:inherit;font-size:inherit;font-family:inherit;line-height:inherit}.prose pre code:after,.prose pre code:before{content:none}.prose table{width:100%;table-layout:auto;text-align:left;margin-top:2em;margin-bottom:2em;font-size:.875em;line-height:1.7142857}.prose thead{color:#111827;font-weight:600;border-bottom-width:1px;border-bottom-color:#d1d5db}.prose thead th{vertical-align:bottom;padding-right:.5714286em;padding-bottom:.5714286em;padding-left:.5714286em}.prose tbody tr{border-bottom-width:1px;border-bottom-color:#e5e7eb}.prose tbody tr:last-child{border-bottom-width:0}.prose tbody td{vertical-align:top;padding:.5714286em}.prose{font-size:1rem;line-height:1.75}.prose p{margin-top:1.25em;margin-bottom:1.25em}.prose figure,.prose img,.prose video{margin-top:2em;margin-bottom:2em}.prose figure>*{margin-top:0;margin-bottom:0}.prose h2 code{font-size:.875em}.prose h3 code{font-size:.9em}.prose ol,.prose ul{margin-top:1.25em;margin-bottom:1.25em}.prose li{margin-top:.5em;margin-bottom:.5em}.prose>ul>li p{margin-top:.75em;margin-bottom:.75em}.prose>ul>li>:first-child{margin-top:1.25em}.prose>ul>li>:last-child{margin-bottom:1.25em}.prose>ol>li>:first-child{margin-top:1.25em}.prose>ol>li>:last-child{margin-bottom:1.25em}.prose ol ol,.prose ol ul,.prose ul ol,.prose ul ul{margin-top:.75em;margin-bottom:.75em}.prose h2+*,.prose h3+*,.prose h4+*,.prose hr+*{margin-top:0}.prose thead th:first-child{padding-left:0}.prose thead th:last-child{padding-right:0}.prose tbody td:first-child{padding-left:0}.prose tbody td:last-child{padding-right:0}.prose>:first-child{margin-top:0}.prose>:last-child{margin-bottom:0}.prose-yellow a,.prose-yellow a code{color:#d97706}.bg-white{--tw-bg-opacity:1;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgba(243,244,246,var(--tw-bg-opacity))}.bg-gray-700{--tw-bg-opacity:1;background-color:rgba(55,65,81,var(--tw-bg-opacity))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgba(31,41,55,var(--tw-bg-opacity))}.bg-yellow-400{--tw-bg-opacity:1;background-color:rgba(251,191,36,var(--tw-bg-opacity))}.bg-green-500{--tw-bg-opacity:1;background-color:rgba(16,185,129,var(--tw-bg-opacity))}.hover\:bg-gray-900:hover{--tw-bg-opacity:1;background-color:rgba(17,24,39,var(--tw-bg-opacity))}.hover\:bg-yellow-300:hover{--tw-bg-opacity:1;background-color:rgba(252,211,77,var(--tw-bg-opacity))}.hover\:bg-green-300:hover{--tw-bg-opacity:1;background-color:rgba(110,231,183,var(--tw-bg-opacity))}.rounded-xl{border-radius:.75rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.table{display:table}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-center{justify-content:center}.flex-1{flex:1 1 0%}.font-light{font-weight:300}.font-medium{font-weight:500}.font-semibold{font-weight:600}.font-bold{font-weight:700}.h-16{height:4rem}.h-full{height:100%}.text-sm{font-size:.875rem;line-height:1.25rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-5xl{font-size:3rem;line-height:1}.leading-tight{line-height:1.25}.m-3{margin:.75rem}.mx-6{margin-left:1.5rem;margin-right:1.5rem}.mx-auto{margin-left:auto;margin-right:auto}.mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mb-2{margin-bottom:.5rem}.mt-6{margin-top:1.5rem}.mb-6{margin-bottom:1.5rem}.ml-6{margin-left:1.5rem}.mr-8{margin-right:2rem}.mt-16{margin-top:4rem}.max-w-sm{max-width:24rem}.object-cover{-o-object-fit:cover;object-fit:cover}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.p-3{padding:.75rem}.p-5{padding:1.25rem}.p-8{padding:2rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-10{padding-top:2.5rem;padding-bottom:2.5rem}.pt-3{padding-top:.75rem}.pl-6{padding-left:1.5rem}.pt-8{padding-top:2rem}.pt-16{padding-top:4rem}.pb-16{padding-bottom:4rem}.fixed{position:fixed}.relative{position:relative}*{--tw-shadow:0 0 transparent}.shadow-md{--tw-shadow:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06)}.shadow-lg,.shadow-md{box-shadow:var(--tw-ring-offset-shadow,0 0 transparent),var(--tw-ring-shadow,0 0 transparent),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05)}*{--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,0.5);--tw-ring-offset-shadow:0 0 transparent;--tw-ring-shadow:0 0 transparent}.text-center{text-align:center}.text-black{--tw-text-opacity:1;color:rgba(0,0,0,var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgba(255,255,255,var(--tw-text-opacity))}.text-gray-500{--tw-text-opacity:1;color:rgba(107,114,128,var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgba(31,41,55,var(--tw-text-opacity))}.text-yellow-500{--tw-text-opacity:1;color:rgba(245,158,11,var(--tw-text-opacity))}.text-green-500{--tw-text-opacity:1;color:rgba(16,185,129,var(--tw-text-opacity))}.text-blue-500{--tw-text-opacity:1;color:rgba(59,130,246,var(--tw-text-opacity))}.text-blue-900{--tw-text-opacity:1;color:rgba(30,58,138,var(--tw-text-opacity))}.text-indigo-500{--tw-text-opacity:1;color:rgba(99,102,241,var(--tw-text-opacity))}.hover\:text-yellow-300:hover{--tw-text-opacity:1;color:rgba(252,211,77,var(--tw-text-opacity))}.hover\:text-yellow-400:hover{--tw-text-opacity:1;color:rgba(251,191,36,var(--tw-text-opacity))}.hover\:text-green-300:hover{--tw-text-opacity:1;color:rgba(110,231,183,var(--tw-text-opacity))}.uppercase{text-transform:uppercase}.hover\:underline:hover{text-decoration:underline}.tracking-wide{letter-spacing:.025em}.w-5\/6{width:83.333333%}.w-full{width:100%}.z-10{z-index:10}.transition{transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-200{transition-duration:.2s}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{transform:scale(2);opacity:0}}@keyframes ping{75%,to{transform:scale(2);opacity:0}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}article a.anchor.before{top:100px}article h1:before,article h2:before,article h3:before{content:" ";display:block;position:relative;padding-top:90px;margin-top:-45px}.prose-yellow a:visited{color:#78350f}.no-scrollbar::-webkit-scrollbar{display:none}.no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}@media (min-width:768px){.md\:flex-row{flex-direction:row}.md\:ml-10{margin-left:2.5rem}.md\:w-48{width:12rem}}@media (min-width:1024px){.lg\:mr-16{margin-right:4rem}}</style><meta name="generator" content="Gatsby 3.1.1"/><title data-react-helmet="true"></title><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{all:inherit;bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 60)
          }), 0)
        }
      }
    })
  </script><link rel="icon" href="/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link as="script" rel="preload" href="/webpack-runtime-30d2d85457af1d51357b.js"/><link as="script" rel="preload" href="/framework-dbb71ad78d33dc3746f8.js"/><link as="script" rel="preload" href="/app-7a28e1fc439eab19f97e.js"/><link as="script" rel="preload" href="/component---src-templates-docs-js-c21cbb8554f3a035a22f.js"/><link as="fetch" rel="preload" href="/page-data/docs/getting-started/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3649515864.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="flex flex-col"><header class="bg-gray-800 text-white fixed w-full z-10"><div class="w-5/6 mx-auto px-6"><div class="flex items-center h-16"><a class="text-yellow-500 hover:text-yellow-400 mr-8 lg:mr-16 items-center" href="/"><span>BHDL</span></a><nav class="flex flex-1 no-scrollbar overflow-x-auto h-full items-center"><a class="flex px-3 hover:bg-gray-900 py-1 transition" href="/docs">Docs</a><a class="flex px-3 hover:bg-gray-900 py-1 transition" href="/blog">Blog</a><a class="flex px-3 hover:bg-gray-900 py-1 transition" href="/example">Examples</a><a class="flex px-3 hover:bg-gray-900 py-1 transition" href="/publication">Publications</a></nav><a href="https://cloud.bhdl.org" target="_blank" class="flex px-3 hover:bg-gray-900 py-1 transition">Cloud</a><a href="https://github.com/lihebi/bhdl" target="_blank" class="flex px-3 hover:bg-gray-900 py-1 transition ">GitHub</a></div></div></header><div class="flex flex-col"><div class="w-5/6 mx-auto px-6"><article class="prose prose-yellow mt-16 pt-16"><h1 class="font-bold"></h1><div><ul>
<li>
<p><a href="#bhdl-getting-started-guide">BHDL Getting Started Guide</a></p>
<ul>
<li><a href="#setting-up">Setting up</a></li>
<li><a href="#the-keyboard-matrix">The keyboard matrix</a></li>
<li><a href="#the-mcu-board">The MCU board</a></li>
<li><a href="#connecting-the-mcu-module-and-matrix-module">Connecting the MCU module and Matrix Module</a></li>
</ul>
</li>
</ul></div><div><h1 id="bhdl-getting-started-guide" style="position:relative;"><a href="#bhdl-getting-started-guide" aria-label="bhdl getting started guide permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>BHDL Getting Started Guide</h1>
<p>The programming with BHDL consists of several steps:</p>
<ol>
<li>
<p>Component Selection. The information needed are:</p>
<ol>
<li>the Pin definition of the IC</li>
<li>specify the desired footprint</li>
</ol>
</li>
<li>
<p>Use <code class="language-text">make-circuit</code> API to compose your circuit. Optionally, hierarchical compose your more complex circuit using <code class="language-text">make-circuit</code>. Each <code class="language-text">make-circuit</code> API expects several components:</p>
<ol>
<li>what the external pins are</li>
<li>connect the components using the 4 types of connection syntax</li>
<li>specify physical layout of components</li>
</ol>
</li>
<li>Expose your design via <code class="language-text">circuit-export</code> API, to KiCAD, PDF, BOM, etc.</li>
</ol>
<p>In this guide, we will go over these steps using a simple keyboard example. We will assume you have a jupyter notebook opened with IRacket kernel. Please refer to the setup documents if you need to setup one, or use our online server.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/2c2ddf1d336ccdbaec0bfaba02252408/d5bfb/demo-board-keyboard-3D.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 98%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAENElEQVQ4y12SWU8bZxSG567qVaUUCoTFOBiD7fE2M559sxnb45nBdkhEoKKbQKlaxF7ATiGAoMFmNYuNCcGQ0BiDEraqNC6lJEqkRlUuWrWK2pv+ln4QqaoiPToaHZ3lPd870Mhkoufr0chYPDo+fWcutby6tbL2bWw+PTm3OrWwPr2YWb6bOz19/fTs77Ozv94CqmvQ3ql895Kp8D3jpUK42MgYMR9qc9vLUX2BpaTEXl4Al8wsbb54/k8+//vJyZ//B+ofGv/AerkSN+owQwVmEMJuz1WRVVlYtJchepAssBTzIX/+yR/Hx7+9BZRM74LxZcgVUAqwe5yUQso3JBNnrkDPkxVYVSFcMhZPnuRfHxz8enT06j+gXO7M4cGLbGXl6JUSh66Wg+11mLeBsgrGYntFqVNXiujfNxcRAff+/su9PcAvF/Ec6OjwldrUWGApupBdZaBqrW6niYMtvLmGsVh4GOYtFsFuYmpG7iyC4lzu2e7u8zdAe49fdnw1hHmxwDU3o3G8xgoaxWqcoNFCiBeCHKuQfIhnFExpbtjaOt3efprN/pzNngGgbPZZbHodFmxEgHJILrAEkTATbwPiEa/LyFhwmTZQJqcXN5DGnujETu7Fxkb+/v0TAJTJ5NPpA9TLoH4C9eK1LMyonE2wWUUHJeOY10XIJKvgfFDkVTzQqK2tfZ9Zf7K+/gMAWkkfbmZ+DH7YjEqIp56lNc4dEurCohD2MAGKUWkyQHP1HIguH+6UkPa+25sbP4Gu1dXvoKXlR/fWjm929Jt5K6vxCFjOwZifAlKtHoRUWR1e7ZRc1bTZ6kExv4vVpMWlR6nU/nLyMZRI7KSSB8MjC1WE0RWgTZy1hoPZet7pcdg8CK8xuB8HQ71hnlIYQaUJPwqWr6QOE4kcNDP7cG5uOx7bpAIiq7Fygwd0cudvzvFhN6eyjEJTKhhBEAHGUYe5/Dgh8/GpB6ALisUeTE5uzs3uyNevI5KTDICzebCTUlmrGwEqmKAA/Afmw6KjiqoFefDztbYPzM3uQhMTmfHxe1Pxhx+3dekJI1PPV+LV4INSuWraZOKtpEJjXgT1kZ4gRys0DcQrLq6+bmxsDRodXR0ZSU+MZ7p7vzFSZuAqq9Lg2cCFvqsiEMxrnKixbFCgZYoOUKTK4TLl9CJNn30BDQ0lzxlO3YouULIohkS3JrBBngZ3+ijgHCLhLj+N+slqxgI0l6K6Gs5cy5rtIgFFIguAwcH528NpKRiE3XanRBAKC7whFBr4V2QvxWRMjxuqcCMl81zAH2766JPW7o7OMaivbxbQ2zsTGVy60fJ5OabnQoLOpb/sKCdlGvVQrN8XbGxp+bSzvX30vGxg8VY0GY0sDwwkoK6uOKCzM9bbM9t2M2oirawsadeam1u+bG2LXORn+vsSfb3z3d3Tbyo7OidBBPwLkJG1Hk4Snv8AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="keyboard-3D"
        title="keyboard-3D"
        src="/static/2c2ddf1d336ccdbaec0bfaba02252408/5a190/demo-board-keyboard-3D.png"
        srcset="/static/2c2ddf1d336ccdbaec0bfaba02252408/772e8/demo-board-keyboard-3D.png 200w,
/static/2c2ddf1d336ccdbaec0bfaba02252408/e17e5/demo-board-keyboard-3D.png 400w,
/static/2c2ddf1d336ccdbaec0bfaba02252408/5a190/demo-board-keyboard-3D.png 800w,
/static/2c2ddf1d336ccdbaec0bfaba02252408/d5bfb/demo-board-keyboard-3D.png 1072w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<h2 id="setting-up" style="position:relative;"><a href="#setting-up" aria-label="setting up permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting up</h2>
<p>The first step is to use the BHDL library via:</p>
<div class="gatsby-highlight" data-language="scheme"><pre class="language-scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token function">putenv</span> <span class="token string">"BHDL_LIBRARY_PATH"</span> <span class="token string">"~/bhdl/bhdl-footprints"</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">require</span> bhdl<span class="token punctuation">)</span></code></pre></div>
<p>Note that you must setup <code class="language-text">BHDL_LIBRARY_PATH</code> ENV variable to your footprint path before requiring the BHDL library.</p>
<p>We probably also need some racket libraries:</p>
<div class="gatsby-highlight" data-language="scheme"><pre class="language-scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token function">require</span> racket/list
         racket/format
         <span class="token punctuation">(</span><span class="token function">prefix-in</span> pict: pict<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>We'll want to add some global signals to refer:</p>
<div class="gatsby-highlight" data-language="scheme"><pre class="language-scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> global
  <span class="token punctuation">(</span><span class="token function">make-circuit</span>
   #:external-pins <span class="token punctuation">(</span><span class="token function">GND</span> 3V3 5V VCC USB5V<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<h2 id="the-keyboard-matrix" style="position:relative;"><a href="#the-keyboard-matrix" aria-label="the keyboard matrix permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The keyboard matrix</h2>
<p>The components:</p>
<ul>
<li>Kailh hot-swap socket: <code class="language-text">kailh-socket</code></li>
<li>Diodes: <code class="language-text">1N4148W</code></li>
</ul>
<div class="gatsby-highlight" data-language="scheme"><pre class="language-scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">key-with-diode</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">make-circuit</span>
   #:external-pins <span class="token punctuation">(</span><span class="token function">left</span> right<span class="token punctuation">)</span>
   #:vars <span class="token punctuation">(</span><span class="token function">[d</span> <span class="token punctuation">(</span><span class="token function">1N4148W</span><span class="token punctuation">)</span>]
           [key <span class="token punctuation">(</span><span class="token function">kailh-socket</span> <span class="token number">1</span><span class="token punctuation">)</span>]<span class="token punctuation">)</span>
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> self.left key d self.right<span class="token punctuation">)</span>
   #:layout <span class="token punctuation">(</span><span class="token function">vc-append</span> key d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>We can call the <code class="language-text">key-with-diode</code> to create this small circuits for each key.</p>
<div class="gatsby-highlight" data-language="scheme"><pre class="language-scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> matrix
  <span class="token punctuation">(</span><span class="token function">for/list</span> <span class="token punctuation">(</span><span class="token function">[row</span> <span class="token punctuation">(</span><span class="token function">in-range</span> <span class="token number">4</span><span class="token punctuation">)</span>]<span class="token punctuation">)</span>
            <span class="token punctuation">(</span><span class="token function">for/list</span> <span class="token punctuation">(</span><span class="token function">[col</span> <span class="token punctuation">(</span><span class="token function">in-range</span> <span class="token number">5</span><span class="token punctuation">)</span>]<span class="token punctuation">)</span>
                      <span class="token punctuation">(</span><span class="token function">key-with-diode</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>The <code class="language-text">matrix</code> variable holds 4x5 keys. We then connect them together:</p>
<div class="gatsby-highlight" data-language="scheme"><pre class="language-scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> matrix-module
  <span class="token punctuation">(</span><span class="token function">make-circuit</span>
   #:external-pins <span class="token punctuation">(</span><span class="token function">row[4]</span> col[5]<span class="token punctuation">)</span>
   <span class="token comment">;; col in, row out</span>
   #:connect <span class="token punctuation">(</span><span class="token function">for*/list</span> <span class="token punctuation">(</span><span class="token function">[i</span> <span class="token punctuation">(</span><span class="token function">in-range</span> <span class="token number">4</span><span class="token punctuation">)</span>]
                        [j <span class="token punctuation">(</span><span class="token function">in-range</span> <span class="token number">5</span><span class="token punctuation">)</span>]<span class="token punctuation">)</span>
                       <span class="token punctuation">(</span><span class="token function">debug</span> <span class="token string">"connecting"</span> i j<span class="token punctuation">)</span>
                       <span class="token punctuation">(</span><span class="token function">*-</span> self.col[j]
                           <span class="token punctuation">(</span><span class="token builtin">list-ref</span> <span class="token punctuation">(</span><span class="token builtin">list-ref</span> matrix i<span class="token punctuation">)</span> j<span class="token punctuation">)</span>
                           self.row[i]<span class="token punctuation">)</span><span class="token punctuation">)</span>
   #:layout <span class="token punctuation">(</span><span class="token function">vc-append</span>
             <span class="token punctuation">(</span><span class="token function">for/list</span> <span class="token punctuation">(</span><span class="token function">[row</span> matrix]<span class="token punctuation">)</span>
                      <span class="token punctuation">(</span><span class="token function">hc-append</span> row ..<span class="token punctuation">)</span>
                      <span class="token punctuation">)</span> ..<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>We note several points here:</p>
<ul>
<li>We don't use <code class="language-text"></code>#:vars<code class="language-text">to create components, because we are using the</code>matrix` variable that is already created</li>
<li>We specify 4+5 external pins for rows and columns, respectively</li>
<li>We use a loop to connect the external row and column pins to the corresponding key in the matrix.</li>
<li>Finally, we specify the layout to be *horizontally append" (via <code class="language-text">hc-append</code> API) to form the rows and "vertically append" (via <code class="language-text">vc-append</code> API) to form the columns.</li>
</ul>
<p>The end result of the key matrix module looks like this:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 474px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/12c5a0a55c478a7484c55a56be702326/5595f/demo-board-matrix.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 98.50000000000001%; position: relative; bottom: 0; left: 0; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="matrix-image"
        title="matrix-image"
        src="/static/12c5a0a55c478a7484c55a56be702326/5595f/demo-board-matrix.png"
        srcset="/static/12c5a0a55c478a7484c55a56be702326/772e8/demo-board-matrix.png 200w,
/static/12c5a0a55c478a7484c55a56be702326/e17e5/demo-board-matrix.png 400w,
/static/12c5a0a55c478a7484c55a56be702326/5595f/demo-board-matrix.png 474w"
        sizes="(max-width: 474px) 100vw, 474px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<h2 id="the-mcu-board" style="position:relative;"><a href="#the-mcu-board" aria-label="the mcu board permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The MCU board</h2>
<p>The components:</p>
<ul>
<li>Atmega32U4</li>
<li>Micro USB connector</li>
<li>16MHz Crystal</li>
<li>Resistors, Capacitors, LEDs will be created "inline"</li>
</ul>
<p>The variables, external pins and layout looks like this:</p>
<div class="gatsby-highlight" data-language="scheme"><pre class="language-scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> mcu-module
  <span class="token punctuation">(</span><span class="token function">make-circuit</span>
   #:vars <span class="token punctuation">(</span><span class="token function">[mcu</span> <span class="token punctuation">(</span><span class="token function">ATmega32U4</span> #:FP <span class="token string">"TQFP-44"</span><span class="token punctuation">)</span>]
           [usb <span class="token punctuation">(</span><span class="token function">USB-Micro</span><span class="token punctuation">)</span>]
           [icsp <span class="token punctuation">(</span><span class="token function">icsp-header</span><span class="token punctuation">)</span>]
           [xtal <span class="token punctuation">(</span><span class="token function">Crystal-4</span> <span class="token symbol">'16MHz</span><span class="token punctuation">)</span>]<span class="token punctuation">)</span>
   #:external-pins <span class="token punctuation">(</span><span class="token function">row[4]</span> col[5]<span class="token punctuation">)</span>
   #:layout <span class="token punctuation">(</span><span class="token function">vc-append</span> <span class="token number">50</span> <span class="token punctuation">(</span><span class="token function">rotate</span> usb pi<span class="token punctuation">)</span> mcu icsp<span class="token punctuation">)</span>
   #:layout ...<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>Some notes about this code snippets:</p>
<ul>
<li><code class="language-text">#:vars</code> section: We create several "big components" in the <code class="language-text">#:vars</code> declaration, including the MCU, USB connector, ICSP header and crystal, because they have multiple pins and we want a handle variable to refer to them. All other components like resistors and capacitors are created "inline", where we don't really want to give them a name.</li>
<li><code class="language-text">#:external-pins</code> section: The external pin of this module is 4+5 pins for row and column scanning of the key matrix.</li>
<li><code class="language-text">#:layout</code> section: We layout the USB, MCU and ICSP header to be vertically appended. We don't care much about the locations of other components such as the resistors, capacitors. They will be placed by our automatic placement engine to appropriate locations by optimizing the total wire length (formally HPWL).</li>
</ul>
<p>There are a lot of staff going on in the connection section, and we'll describe them in small sections. First, the ICSP connector for flashing firmware:</p>
<div class="gatsby-highlight" data-language="scheme"><pre class="language-scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> mcu-module
  <span class="token punctuation">(</span><span class="token function">make-circuit</span>
   ...
   #:connect <span class="token punctuation">(</span><span class="token function">*=</span> <span class="token punctuation">(</span><span class="token function">mcu</span> <span class="token punctuation">(</span><span class="token function">MOSI</span> SCLK MISO RESET VCC GND<span class="token punctuation">)</span><span class="token punctuation">)</span>
               <span class="token punctuation">(</span><span class="token function">icsp</span> <span class="token punctuation">(</span><span class="token function">MOSI</span> SCK MISO RESET VCC GND<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   ...<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>Then the Power module including reset and switch:</p>
<div class="gatsby-highlight" data-language="scheme"><pre class="language-scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> mcu-module
  <span class="token punctuation">(</span><span class="token function">make-circuit</span>
   ...
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> mcu.VCC mcu.UVCC mcu.AVCC global.VCC<span class="token punctuation">)</span>
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> mcu.GND mcu.UGND global.GND<span class="token punctuation">)</span>
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> mcu.RESET <span class="token punctuation">(</span><span class="token function">*&lt;</span> <span class="token punctuation">(</span><span class="token function">LL4148</span><span class="token punctuation">)</span>
                           <span class="token punctuation">(</span><span class="token function">R</span> <span class="token symbol">'10k</span><span class="token punctuation">)</span><span class="token punctuation">)</span> global.5V<span class="token punctuation">)</span>
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> mcu.RESET[-1] <span class="token punctuation">(</span><span class="token function">Switch</span><span class="token punctuation">)</span> global.GND<span class="token punctuation">)</span>
   <span class="token comment">;; An LED for blinking</span>
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> mcu.PC6 <span class="token punctuation">(</span><span class="token function">R</span> <span class="token symbol">'1k</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">LED0603</span> <span class="token symbol">'red</span><span class="token punctuation">)</span> global.GND<span class="token punctuation">)</span>
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> mcu.UCAP <span class="token punctuation">(</span><span class="token function">C</span> <span class="token symbol">'1uf</span><span class="token punctuation">)</span> global.GND<span class="token punctuation">)</span>
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> global.VCC <span class="token punctuation">(</span><span class="token function">*&lt;</span> <span class="token punctuation">(</span><span class="token function">C</span> <span class="token symbol">'1uf</span><span class="token punctuation">)</span>
                          <span class="token punctuation">(</span><span class="token function">C</span> <span class="token symbol">'100nf</span><span class="token punctuation">)</span>
                          <span class="token punctuation">(</span><span class="token function">C</span> <span class="token symbol">'100nf</span><span class="token punctuation">)</span>
                          <span class="token punctuation">(</span><span class="token function">C</span> <span class="token symbol">'100nf</span><span class="token punctuation">)</span>
                          <span class="token punctuation">(</span><span class="token function">C</span> <span class="token symbol">'100nf</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           global.GND<span class="token punctuation">)</span>
   ...<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>The crystal module:</p>
<div class="gatsby-highlight" data-language="scheme"><pre class="language-scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> mcu-module
  <span class="token punctuation">(</span><span class="token function">make-circuit</span>
   ...
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> mcu.XTAL1 xtal.XIN<span class="token punctuation">)</span>
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> xtal.XOUT mcu.XTAL2<span class="token punctuation">)</span>
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> xtal.GND global.GND<span class="token punctuation">)</span>
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> mcu.XTAL1 <span class="token punctuation">(</span><span class="token function">C</span> <span class="token symbol">'22pf</span><span class="token punctuation">)</span> global.GND<span class="token punctuation">)</span>
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> mcu.XTAL2 <span class="token punctuation">(</span><span class="token function">C</span> <span class="token symbol">'22pf</span><span class="token punctuation">)</span> global.GND<span class="token punctuation">)</span>
   ...
   <span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>The USB connector:</p>
<div class="gatsby-highlight" data-language="scheme"><pre class="language-scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> mcu-module
  <span class="token punctuation">(</span><span class="token function">make-circuit</span>
   ...
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> mcu.D+ <span class="token punctuation">(</span><span class="token function">R</span> <span class="token number">22</span><span class="token punctuation">)</span> usb.D+<span class="token punctuation">)</span>
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> mcu.D- <span class="token punctuation">(</span><span class="token function">R</span> <span class="token number">22</span><span class="token punctuation">)</span> usb.D-<span class="token punctuation">)</span>
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> mcu.VBUS usb.VBUS global.VCC<span class="token punctuation">)</span>
   #:connect <span class="token punctuation">(</span><span class="token function">*-</span> mcu.UGND usb.GND global.GND<span class="token punctuation">)</span>
   ...
   <span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>Finally, we select some GPIO pins for row and column scanning the matrix:</p>
<div class="gatsby-highlight" data-language="scheme"><pre class="language-scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> mcu-module
  <span class="token punctuation">(</span><span class="token function">make-circuit</span>
   ...
   #:connect <span class="token punctuation">(</span><span class="token function">*=</span> <span class="token punctuation">(</span><span class="token function">self</span> row [0 3]<span class="token punctuation">)</span>
                 <span class="token punctuation">(</span><span class="token function">self</span> row [0 3]<span class="token punctuation">)</span>
                 <span class="token punctuation">(</span><span class="token function">mcu</span> [PB0 PB4 PB5 PB6]<span class="token punctuation">)</span><span class="token punctuation">)</span>
   #:connect <span class="token punctuation">(</span><span class="token function">*=</span> <span class="token punctuation">(</span><span class="token function">self</span> col [0 4]<span class="token punctuation">)</span>
                 <span class="token punctuation">(</span><span class="token function">mcu</span> [PD0 PD1 PD2 PD3 PD4]<span class="token punctuation">)</span><span class="token punctuation">)</span>
   ...
   <span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>The end result would looks like this:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 158px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/4238069986e3ecfd9552027d1089b9ba/c26ae/demo-board-mcu.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 139.873417721519%; position: relative; bottom: 0; left: 0; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="mcu-image"
        title="mcu-image"
        src="/static/4238069986e3ecfd9552027d1089b9ba/c26ae/demo-board-mcu.png"
        srcset="/static/4238069986e3ecfd9552027d1089b9ba/c26ae/demo-board-mcu.png 158w"
        sizes="(max-width: 158px) 100vw, 158px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<h2 id="connecting-the-mcu-module-and-matrix-module" style="position:relative;"><a href="#connecting-the-mcu-module-and-matrix-module" aria-label="connecting the mcu module and matrix module permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Connecting the MCU module and Matrix Module</h2>
<p>This is simply:</p>
<div class="gatsby-highlight" data-language="scheme"><pre class="language-scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> keyboard <span class="token punctuation">(</span><span class="token function">make-circuit</span>
 #:connect <span class="token punctuation">(</span><span class="token function">*=</span> <span class="token punctuation">(</span><span class="token function">mcu-module</span> row [0 3]<span class="token punctuation">)</span>
               <span class="token punctuation">(</span><span class="token function">matrix-module</span> row [0 3]<span class="token punctuation">)</span><span class="token punctuation">)</span>
 #:connect <span class="token punctuation">(</span><span class="token function">*=</span> <span class="token punctuation">(</span><span class="token function">mcu-module</span> col [0 4]<span class="token punctuation">)</span>
               <span class="token punctuation">(</span><span class="token function">matrix-module</span> col [0 4]<span class="token punctuation">)</span><span class="token punctuation">)</span>
 #:layout <span class="token punctuation">(</span><span class="token function">vc-append</span> mcu-module matrix-module<span class="token punctuation">)</span>
                  <span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>And we export the keyboard to KiCAD, PNG, BOM:</p>
<div class="gatsby-highlight" data-language="scheme"><pre class="language-scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">parameterize</span> <span class="token punctuation">(</span><span class="token function">[current-directory</span> <span class="token string">"./out/demo-board/keyboard"</span>]
                 [padding-general 2]<span class="token punctuation">)</span>
                <span class="token punctuation">(</span><span class="token function">circuit-export</span> keyboard
                                #:auto-place <span class="token boolean">#t</span>
                                #:formats <span class="token punctuation">'</span><span class="token punctuation">(</span>kicad pdf png bom<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>The keyboard looks like this:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 321px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/60cd5e60fe0643124383caa44be65c48/30592/demo-board-keyboard.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 149.5%; position: relative; bottom: 0; left: 0; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="keyboard-img"
        title="keyboard-img"
        src="/static/60cd5e60fe0643124383caa44be65c48/30592/demo-board-keyboard.png"
        srcset="/static/60cd5e60fe0643124383caa44be65c48/772e8/demo-board-keyboard.png 200w,
/static/60cd5e60fe0643124383caa44be65c48/30592/demo-board-keyboard.png 321w"
        sizes="(max-width: 321px) 100vw, 321px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>The BOM.csv contains the mapping from the annotations (e.g. U1, R4, D3) to the component name, footprint, and value.</p>
<table>
<thead>
<tr>
<th align="center"><strong>Annotation</strong></th>
<th align="center">** Name**</th>
<th align="center">** Footprint**</th>
<th align="center">** Values**</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">U36</td>
<td align="center">kailh-socket</td>
<td align="center">1</td>
<td align="center">()</td>
</tr>
<tr>
<td align="center">D37</td>
<td align="center">1N4148W</td>
<td align="center">#f</td>
<td align="center">()</td>
</tr>
<tr>
<td align="center">U38</td>
<td align="center">kailh-socket</td>
<td align="center">1</td>
<td align="center">()</td>
</tr>
<tr>
<td align="center">D39</td>
<td align="center">1N4148W</td>
<td align="center">#f</td>
<td align="center">()</td>
</tr>
<tr>
<td align="center">U40</td>
<td align="center">kailh-socket</td>
<td align="center">1</td>
<td align="center">()</td>
</tr>
<tr>
<td align="center">U41</td>
<td align="center">ATmega16U4/ATmega32U4</td>
<td align="center">TQFP-44</td>
<td align="center">()</td>
</tr>
<tr>
<td align="center">U42</td>
<td align="center">USB-Micro</td>
<td align="center">#f</td>
<td align="center">()</td>
</tr>
<tr>
<td align="center">U43</td>
<td align="center">PinHeader2</td>
<td align="center">3</td>
<td align="center">()</td>
</tr>
<tr>
<td align="center">U44</td>
<td align="center">Crystal-4</td>
<td align="center">#f</td>
<td align="center">(16MHz)</td>
</tr>
<tr>
<td align="center">R45</td>
<td align="center">Resistor/R</td>
<td align="center">0603</td>
<td align="center">(1k)</td>
</tr>
<tr>
<td align="center">LED46</td>
<td align="center">LED0603</td>
<td align="center">#f</td>
<td align="center">(red)</td>
</tr>
<tr>
<td align="center">D47</td>
<td align="center">LL4148</td>
<td align="center">#f</td>
<td align="center">()</td>
</tr>
<tr>
<td align="center">R48</td>
<td align="center">Resistor/R</td>
<td align="center">0603</td>
<td align="center">(10k)</td>
</tr>
<tr>
<td align="center">KEY49</td>
<td align="center">SKRPACE010</td>
<td align="center">#f</td>
<td align="center">()</td>
</tr>
<tr>
<td align="center">C50</td>
<td align="center">Capacitor/C</td>
<td align="center">#f</td>
<td align="center">(1uf)</td>
</tr>
<tr>
<td align="center">C51</td>
<td align="center">Capacitor/C</td>
<td align="center">#f</td>
<td align="center">(1uf)</td>
</tr>
<tr>
<td align="center">C52</td>
<td align="center">Capacitor/C</td>
<td align="center">#f</td>
<td align="center">(100nf)</td>
</tr>
<tr>
<td align="center">C53</td>
<td align="center">Capacitor/C</td>
<td align="center">#f</td>
<td align="center">(100nf)</td>
</tr>
<tr>
<td align="center">C54</td>
<td align="center">Capacitor/C</td>
<td align="center">#f</td>
<td align="center">(100nf)</td>
</tr>
<tr>
<td align="center">C55</td>
<td align="center">Capacitor/C</td>
<td align="center">#f</td>
<td align="center">(100nf)</td>
</tr>
<tr>
<td align="center">C56</td>
<td align="center">Capacitor/C</td>
<td align="center">#f</td>
<td align="center">(22pf)</td>
</tr>
<tr>
<td align="center">C57</td>
<td align="center">Capacitor/C</td>
<td align="center">#f</td>
<td align="center">(22pf)</td>
</tr>
<tr>
<td align="center">R58</td>
<td align="center">Resistor/R</td>
<td align="center">0603</td>
<td align="center">(22)</td>
</tr>
<tr>
<td align="center">R59</td>
<td align="center">Resistor/R</td>
<td align="center">0603</td>
<td align="center">(22)</td>
</tr>
</tbody>
</table>
<p>The <code class="language-text">.kicad_pcb</code> file can be opened by the popular open source PCB EDA software KiCAD. The routing can be done by the open source freerouting software automatically. The end board is manufacture-ready, and looks like this in KiCAD's 3D-viewer:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/2c2ddf1d336ccdbaec0bfaba02252408/d5bfb/demo-board-keyboard-3D.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 98%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAENElEQVQ4y12SWU8bZxSG567qVaUUCoTFOBiD7fE2M559sxnb45nBdkhEoKKbQKlaxF7ATiGAoMFmNYuNCcGQ0BiDEraqNC6lJEqkRlUuWrWK2pv+ln4QqaoiPToaHZ3lPd870Mhkoufr0chYPDo+fWcutby6tbL2bWw+PTm3OrWwPr2YWb6bOz19/fTs77Ozv94CqmvQ3ql895Kp8D3jpUK42MgYMR9qc9vLUX2BpaTEXl4Al8wsbb54/k8+//vJyZ//B+ofGv/AerkSN+owQwVmEMJuz1WRVVlYtJchepAssBTzIX/+yR/Hx7+9BZRM74LxZcgVUAqwe5yUQso3JBNnrkDPkxVYVSFcMhZPnuRfHxz8enT06j+gXO7M4cGLbGXl6JUSh66Wg+11mLeBsgrGYntFqVNXiujfNxcRAff+/su9PcAvF/Ec6OjwldrUWGApupBdZaBqrW6niYMtvLmGsVh4GOYtFsFuYmpG7iyC4lzu2e7u8zdAe49fdnw1hHmxwDU3o3G8xgoaxWqcoNFCiBeCHKuQfIhnFExpbtjaOt3efprN/pzNngGgbPZZbHodFmxEgHJILrAEkTATbwPiEa/LyFhwmTZQJqcXN5DGnujETu7Fxkb+/v0TAJTJ5NPpA9TLoH4C9eK1LMyonE2wWUUHJeOY10XIJKvgfFDkVTzQqK2tfZ9Zf7K+/gMAWkkfbmZ+DH7YjEqIp56lNc4dEurCohD2MAGKUWkyQHP1HIguH+6UkPa+25sbP4Gu1dXvoKXlR/fWjm929Jt5K6vxCFjOwZifAlKtHoRUWR1e7ZRc1bTZ6kExv4vVpMWlR6nU/nLyMZRI7KSSB8MjC1WE0RWgTZy1hoPZet7pcdg8CK8xuB8HQ71hnlIYQaUJPwqWr6QOE4kcNDP7cG5uOx7bpAIiq7Fygwd0cudvzvFhN6eyjEJTKhhBEAHGUYe5/Dgh8/GpB6ALisUeTE5uzs3uyNevI5KTDICzebCTUlmrGwEqmKAA/Afmw6KjiqoFefDztbYPzM3uQhMTmfHxe1Pxhx+3dekJI1PPV+LV4INSuWraZOKtpEJjXgT1kZ4gRys0DcQrLq6+bmxsDRodXR0ZSU+MZ7p7vzFSZuAqq9Lg2cCFvqsiEMxrnKixbFCgZYoOUKTK4TLl9CJNn30BDQ0lzxlO3YouULIohkS3JrBBngZ3+ijgHCLhLj+N+slqxgI0l6K6Gs5cy5rtIgFFIguAwcH528NpKRiE3XanRBAKC7whFBr4V2QvxWRMjxuqcCMl81zAH2766JPW7o7OMaivbxbQ2zsTGVy60fJ5OabnQoLOpb/sKCdlGvVQrN8XbGxp+bSzvX30vGxg8VY0GY0sDwwkoK6uOKCzM9bbM9t2M2oirawsadeam1u+bG2LXORn+vsSfb3z3d3Tbyo7OidBBPwLkJG1Hk4Snv8AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="keyboard-3D"
        title="keyboard-3D"
        src="/static/2c2ddf1d336ccdbaec0bfaba02252408/5a190/demo-board-keyboard-3D.png"
        srcset="/static/2c2ddf1d336ccdbaec0bfaba02252408/772e8/demo-board-keyboard-3D.png 200w,
/static/2c2ddf1d336ccdbaec0bfaba02252408/e17e5/demo-board-keyboard-3D.png 400w,
/static/2c2ddf1d336ccdbaec0bfaba02252408/5a190/demo-board-keyboard-3D.png 800w,
/static/2c2ddf1d336ccdbaec0bfaba02252408/d5bfb/demo-board-keyboard-3D.png 1072w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p></div></article></div></div><footer class="w-full bg-gray-800 text-white py-10"><div class="w-5/6 mx-auto px-6"><div class="ml-6 mb-6">Copyright © 2021 BHDL Team.</div><div class="w-full flex flex-wrap justify-center"><div class="flex flex-1 flex-col ml-6"><h3 class="text-white font-bold mb-2 text-lg">Docs</h3><p>Getting Started</p><p>Installation</p><p>Tutorial</p></div><div class="flex flex-1 flex-col ml-6"><h3 class="text-white font-bold mb-2 text-lg">Community</h3><p>GitHub</p><p>Twitter</p><p>Blog</p><p>Discord</p><p>Stack Overflow</p></div><div class="flex flex-1 flex-col ml-6"><h3 class="text-white font-bold mb-2 text-lg">About</h3><p>About Us</p><p>Team</p><p>Contact</p></div></div></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/docs/getting-started/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-b6ed67c7e16a3cb88a12.js"],"app":["/app-7a28e1fc439eab19f97e.js"],"component---src-pages-404-js":["/component---src-pages-404-js-87ed337f26418eca33df.js"],"component---src-pages-about-js":["/component---src-pages-about-js-6256013732c360de8184.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-2e2b18982e78613a0614.js"],"component---src-pages-example-js":["/component---src-pages-example-js-709096886243d3fed9e9.js"],"component---src-pages-index-js":["/component---src-pages-index-js-1b7b56014b3bfcec3182.js"],"component---src-pages-page-2-js":["/component---src-pages-page-2-js-4bebeb4b10d0d8bfe8e7.js"],"component---src-pages-publication-js":["/component---src-pages-publication-js-546fd86924e6f79db955.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-e57aa43080a30b22226a.js"],"component---src-templates-docs-js":["/component---src-templates-docs-js-c21cbb8554f3a035a22f.js"]};/*]]>*/</script><script src="/polyfill-b6ed67c7e16a3cb88a12.js" nomodule=""></script><script src="/component---src-templates-docs-js-c21cbb8554f3a035a22f.js" async=""></script><script src="/app-7a28e1fc439eab19f97e.js" async=""></script><script src="/framework-dbb71ad78d33dc3746f8.js" async=""></script><script src="/webpack-runtime-30d2d85457af1d51357b.js" async=""></script></body></html>